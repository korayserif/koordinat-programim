<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Koordinat dÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ - Profesyonel koordinat dÃ¶nÃ¼ÅŸtÃ¼rme aracÄ±. DXF ve script formatlarÄ±na dÃ¶nÃ¼ÅŸtÃ¼rme.">
    <meta name="keywords" content="koordinat dÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼, DXF, script, koordinat Ã§evirici">
    <meta name="author" content="Adil Koray Serifagaoglu">
    <meta name="robots" content="noindex, nofollow">
    <title>Koordinat DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ - Profesyonel AraÃ§</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height:100vh; padding:20px; }
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:1000; }
        .modal { background:white; padding:30px; border-radius:15px; max-width:500px; width:90%; text-align:center; box-shadow:0 20px 40px rgba(0,0,0,0.3); }
        .modal h2 { color:#333; margin-bottom:20px; background:linear-gradient(135deg,#667eea,#764ba2); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .modal p { color:#666; margin-bottom:20px; line-height:1.6; }
        .modal input { width:100%; padding:12px; border:2px solid #ddd; border-radius:8px; font-size:16px; margin-bottom:15px; }
        .modal input:focus { outline:none; border-color:#667eea; }
        .modal-buttons { display:flex; gap:15px; justify-content:center; flex-wrap:wrap; }
        .modal .tabs { display:flex; margin-bottom:20px; border-bottom:1px solid #eee; }
        .modal .tab { flex:1; padding:10px; cursor:pointer; background:transparent; border:none; color:#666; font-weight:500; }
        .modal .tab.active { color:#667eea; border-bottom:2px solid #667eea; }
        .modal .tab-content { display:none; }
        .modal .tab-content.active { display:block; }
        .hidden { display:none; }
        .container { max-width:1200px; margin:0 auto; background:rgba(255,255,255,0.95); border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.1); padding:30px; backdrop-filter:blur(10px); }
        .header { text-align:center; margin-bottom:30px; padding-bottom:20px; border-bottom:2px solid #eee; position:relative; }
        .header h1 { color:#333; font-size:2.5em; margin-bottom:10px; background:linear-gradient(135deg,#667eea,#764ba2); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .header .author { color:#666; font-size:1.1em; font-style:italic; }
        .header .user-info { position:absolute; top:0; right:0; background:#f8f9fa; padding:10px 15px; border-radius:8px; font-size:0.9em; color:#666; }
        .header .logout-btn { background:#dc3545; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; margin-left:10px; font-size:0.8em; }
        .main-content { display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:30px; }
        .input-section, .output-section { background:#f8f9fa; padding:25px; border-radius:15px; border:1px solid #e9ecef; }
        .section-title { font-size:1.4em; color:#333; margin-bottom:15px; font-weight:600; }
        textarea { width:100%; height:300px; border:2px solid #ddd; border-radius:10px; padding:15px; font-family:'Courier New',monospace; font-size:14px; line-height:1.4; resize:vertical; transition:border-color 0.3s ease; }
        textarea:focus { outline:none; border-color:#667eea; }
        .controls { display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap; }
        .btn { padding:12px 24px; border:none; border-radius:8px; cursor:pointer; font-size:14px; font-weight:600; transition:all 0.3s ease; text-decoration:none; display:inline-flex; align-items:center; gap:8px; }
        .btn-primary { background:linear-gradient(135deg,#667eea,#764ba2); color:white; }
        .btn-primary:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(102,126,234,0.3); }
        .btn-secondary { background:#6c757d; color:white; }
        .btn-secondary:hover { background:#5a6268; transform:translateY(-2px); }
        .btn-success { background:#28a745; color:white; }
        .btn-success:hover { background:#218838; transform:translateY(-2px); }
        .btn-locked { background:#dc3545; color:white; opacity:0.7; cursor:not-allowed; }
        .format-info { background:#e3f2fd; border:1px solid #90caf9; border-radius:8px; padding:15px; margin-bottom:20px; font-size:14px; color:#1565c0; }
        .footer { text-align:center; padding-top:20px; border-top:2px solid #eee; color:#666; font-size:0.9em; }
        .security-info { background:#fff3cd; border:1px solid #ffeaa7; border-radius:8px; padding:15px; margin-bottom:15px; font-size:14px; color:#856404; text-align: left; }
        .verification-code { background:#d4edda; border:1px solid #c3e6cb; border-radius:8px; padding:15px; margin-bottom:15px; }
        .timer { color:#dc3545; font-weight:bold; }
        .license-warning { background:#f8d7da; border:1px solid #f5c6cb; border-radius:8px; padding:15px; margin-bottom:15px; color:#721c24; }
        .premium-badge { background:#28a745; color:white; padding:3px 8px; border-radius:12px; font-size:0.8em; margin-left:10px; }
        @media(max-width:768px){ .main-content{grid-template-columns:1fr; gap:20px;} .controls{flex-direction:column;} .btn{width:100%; justify-content:center;} .header .user-info{position:static; margin-top:10px;} }
    </style>
</head>
<body>
    
    <div id="authModal" class="modal-overlay">
        <div class="modal">
            <h2>ğŸ” GÃ¼venli GiriÅŸ</h2>
            <div class="tabs">
                <button class="tab active" data-tab="license">Lisans</button>
                <button class="tab" data-tab="email">E-mail</button>
                <button class="tab" data-tab="hardware">DonanÄ±m</button>
            </div>
            <div class="tab-content active" id="licenseTab">
                <p><strong>Lisans AnahtarÄ± ile GiriÅŸ</strong></p>
                <input type="password" id="licenseKey" placeholder="Lisans anahtarÄ±nÄ±zÄ± girin..." maxlength="20">
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="checkLicense()">âœ“ GiriÅŸ Yap</button>
                </div>
            </div>
            <div class="tab-content" id="emailTab">
                <p><strong>E-mail ile DoÄŸrulama</strong></p>
                <div class="security-info">
                    <strong>EriÅŸim Seviyeleri:</strong><br>
                    â€¢ korayserif@gmail.com <span style="color:#28a745; font-weight:bold;">(TAM ERÄ°ÅÄ°M)</span><br>
                    <small>DiÄŸer tÃ¼m e-posta adresleri SÄ±nÄ±rlÄ± EriÅŸim ile giriÅŸ yapabilir.</small>
                </div>
                <input type="email" id="emailInput" placeholder="E-mail adresinizi girin...">
                <input type="text" id="emailCode" placeholder="6 haneli doÄŸrulama kodunu girin" maxlength="6" style="display:none;">
                <div id="codeTimer" class="verification-code" style="display:none;">
                    <span class="timer" id="timer">300</span> saniye iÃ§inde kodu girin
                </div>
                <div id="emailStatus" class="verification-code" style="display:none;">
                    <strong>âœ… E-mail gÃ¶nderildi!</strong><br>
                    <small>Spam klasÃ¶rÃ¼nÃ¼ de kontrol edin</small>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" id="emailBtn" onclick="sendVerificationCode()">ğŸ“§ Kod GÃ¶nder</button>
                </div>
            </div>
            <div class="tab-content" id="hardwareTab">
                <p><strong>DonanÄ±m Kimlik DoÄŸrulama</strong></p>
                <div class="security-info">
                    Bu sistem bilgisayarÄ±nÄ±zÄ±n benzersiz kimliÄŸini kontrol eder.
                </div>
                <div id="hardwareInfo" style="font-family:monospace; background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px; font-size:12px; text-align:left;">
                    DonanÄ±m bilgileri yÃ¼kleniyor...
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="checkHardware()">ğŸ–¥ï¸ DonanÄ±m KontrolÃ¼</button>
                </div>
            </div>
            <div class="modal-buttons" style="margin-top:20px;">
                <button class="btn btn-secondary" onclick="window.close()">âœ• Ä°ptal</button>
            </div>
        </div>
    </div>
    
    <div id="licenseRequestModal" class="modal-overlay" style="display:none;">
        <div class="modal">
            <h2>ğŸ”’ Lisans Gerekli</h2>
            <div class="license-warning">
                <strong>Bu Ã¶zellik iÃ§in lisans anahtarÄ± gereklidir!</strong><br>
                E-mail hesabÄ±nÄ±z ile sadece gÃ¶rÃ¼ntÃ¼leme yapabilirsiniz.
            </div>
            <p>Koordinat dÃ¶nÃ¼ÅŸtÃ¼rme ve indirme iÅŸlemleri iÃ§in geÃ§erli bir lisans anahtarÄ± girin:</p>
            <input type="password" id="tempLicenseKey" placeholder="Lisans anahtarÄ±nÄ±zÄ± girin..." maxlength="20">
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="checkTempLicense()">âœ“ DoÄŸrula</button>
                <button class="btn btn-secondary" onclick="closeLicenseRequest()">âœ• Ä°ptal</button>
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display:none;">
        <div class="header">
            <h1>ğŸ—ºï¸ Koordinat DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼</h1>
            <div class="author">Â© 2025 Adil Koray Serifagaoglu - TÃ¼m HaklarÄ± SaklÄ±dÄ±r</div>
            <div class="user-info" id="userInfo">
                KullanÄ±cÄ±: YÃ¼kleniyor...
                <button class="logout-btn" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
            </div>
        </div>
        <div class="main-content">
            <div class="input-section">
                <h3 class="section-title">ğŸ“¥ Girdi KoordinatlarÄ±</h3>
                <div class="format-info"><strong>Girdi FormatÄ±:</strong><br>Nokta_No X Y Z (boÅŸluk ile ayrÄ±lmÄ±ÅŸ)</div>
                <textarea id="inputData" placeholder="KoordinatlarÄ±nÄ±zÄ± buraya yapÄ±ÅŸtÄ±rÄ±n..."></textarea>
            </div>
            <div class="output-section">
                <h3 class="section-title">ğŸ“¤ Ã‡Ä±ktÄ±</h3>
                <div class="controls">
                    <button class="btn btn-secondary" id="dxfBtn" onclick="convertToDXF()">ğŸ“„ DXF FormatÄ±</button>
                    <button class="btn btn-secondary" id="scriptBtn" onclick="convertToScript()">ğŸ“ Script FormatÄ±</button>
                </div>
                <textarea id="outputData" placeholder="DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ koordinatlar burada gÃ¶rÃ¼necek..." readonly></textarea>
                <div style="margin-top:15px;">
                    <button class="btn btn-success" id="downloadBtn" onclick="downloadFile()">ğŸ’¾ Dosya Ä°ndir</button>
                </div>
            </div>
        </div>
        <div class="footer">
            <p><strong>Koordinat DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ v2.0 - GÃ¼venli SÃ¼rÃ¼m</strong></p>
            <p>Bu yazÄ±lÄ±mÄ±n tÃ¼m haklarÄ± <strong>Adil Koray Serifagaoglu</strong>'na aittir.</p>
            <p>Yetkisiz kullanÄ±m yasaktÄ±r. Â© 2025</p>
        </div>
    </div>
    
    <script>
        let currentVerificationCode = null;
        let verificationEmail = null;
        let currentUser = null;
        let sessionExpiry = null;
        let currentFormat = 'point';
        let processedData = [];
        let verificationTimer = null;
        let pendingOperation = null;

        const VALID_LICENSE_HASHES = new Set([
            'd524c673d0d7d1716a4a5de4db83ff35a620169cae373b892d6794d2713b4d14',
            '463639a74d091d34db0ce0b6d9c471ac2a55675156f51c4c209d04974c753527',
            '54db75728cf5cd330d98b597008686454094ec1846ab6bd71b7fd422c1b8917a',
            'b066a54250e36e2be53a6a4f2b3c33ca210d15e2b42af7664c928781dfcae4b8'
        ]);
        
        const PREMIUM_EMAIL = 'korayserif@gmail.com';

        const AUTHORIZED_HARDWARE = new Set([
            'HW001-DESKTOP-ABC123',
            'HW002-LAPTOP-DEF456',
            'HW003-WORKSTATION-GHI789'
        ]);

        async function sha256Hex(text) {
            const enc = new TextEncoder().encode(text);
            const buf = await crypto.subtle.digest('SHA-256', enc);
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
        }

        function hasFullAccess() {
            return currentUser && (
                currentUser.method === 'license' || 
                currentUser.method === 'hardware' ||
                (currentUser.method === 'email' && currentUser.permission === 'premium')
            );
        }

        function switchTab(element, tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        async function checkLicense() {
            const keyInput = document.getElementById('licenseKey');
            const key = keyInput.value.trim();
            if (!key) { alert('Lisans anahtarÄ± giriniz.'); keyInput.focus(); return; }
            try {
                const hash = await sha256Hex(key.toUpperCase());
                if (VALID_LICENSE_HASHES.has(hash)) {
                    loginUser('Lisans KullanÄ±cÄ±sÄ±', 'license', 'premium');
                } else {
                    alert('âŒ GeÃ§ersiz lisans anahtarÄ±!');
                    keyInput.value=''; keyInput.focus();
                }
            } catch(e) { console.error(e); alert('DoÄŸrulama sÄ±rasÄ±nda hata oluÅŸtu.'); }
        }

        async function checkTempLicense() {
            const keyInput = document.getElementById('tempLicenseKey');
            const key = keyInput.value.trim();
            if (!key) { alert('Lisans anahtarÄ± giriniz.'); keyInput.focus(); return; }
            try {
                const hash = await sha256Hex(key.toUpperCase());
                if (VALID_LICENSE_HASHES.has(hash)) {
                    closeLicenseRequest();
                    if (pendingOperation) { pendingOperation(); pendingOperation = null; }
                } else {
                    alert('âŒ GeÃ§ersiz lisans anahtarÄ±!');
                    keyInput.value=''; keyInput.focus();
                }
            } catch(e) { console.error(e); alert('DoÄŸrulama sÄ±rasÄ±nda hata oluÅŸtu.'); }
        }

        function closeLicenseRequest() {
            document.getElementById('licenseRequestModal').style.display = 'none';
            document.getElementById('tempLicenseKey').value = '';
            pendingOperation = null;
        }

        function requestLicenseForOperation(operation) {
            pendingOperation = operation;
            document.getElementById('licenseRequestModal').style.display = 'flex';
            document.getElementById('tempLicenseKey').focus();
        }

        // ---------- BURASI EN Ã–NEMLÄ° DEÄÄ°ÅÄ°KLÄ°K ----------
        async function sendVerificationCode() {
            const email = document.getElementById('emailInput').value.trim();
            if (!email) {
                alert('E-mail adresinizi girin!');
                document.getElementById('emailInput').focus();
                return;
            }

            const emailBtn = document.getElementById('emailBtn');
            emailBtn.disabled = true;
            emailBtn.innerHTML = 'ğŸ“§ GÃ¶nderiliyor...';

            try {
                // Bizim gÃ¼venli Netlify fonksiyonumuza istek gÃ¶nderiyoruz
                const response = await fetch('/.netlify/functions/send-email', {
                    method: 'POST',
                    body: JSON.stringify({ email: email }),
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                if (!response.ok || !result.success) {
                    // EÄŸer fonksiyon hata dÃ¶ndÃ¼rÃ¼rse
                    throw new Error(result.message || 'Sunucuda bir hata oluÅŸtu.');
                }

                // Fonksiyondan gelen doÄŸrulama kodunu deÄŸiÅŸkene ata
                currentVerificationCode = result.code;
                verificationEmail = email;

                // ArayÃ¼zÃ¼ gÃ¼ncelle
                document.getElementById('emailCode').style.display = 'block';
                document.getElementById('emailStatus').style.display = 'block';
                document.getElementById('codeTimer').style.display = 'block';
                
                emailBtn.innerHTML = 'âœ“ Kodu DoÄŸrula';
                emailBtn.onclick = verifyEmailCode;
                emailBtn.disabled = false;

                startTimer(300);
                document.getElementById('emailCode').focus();

            } catch (error) {
                console.error('E-mail gÃ¶nderme hatasÄ±:', error);
                alert(`âš ï¸ E-mail gÃ¶nderimi baÅŸarÄ±sÄ±z oldu: ${error.message}`);
                emailBtn.innerHTML = 'ğŸ“§ Kod GÃ¶nder';
                emailBtn.disabled = false;
            }
        }
        // ---------- DEÄÄ°ÅÄ°KLÄ°K SONU ----------

        function verifyEmailCode() {
            const inputCode = document.getElementById('emailCode').value.trim();
            if (!inputCode) { alert('DoÄŸrulama kodunu girin!'); document.getElementById('emailCode').focus(); return; }
            if (inputCode === currentVerificationCode) {
                clearTimeout(verificationTimer);
                let permission = (verificationEmail.toLowerCase() === PREMIUM_EMAIL) ? 'premium' : 'limited';
                loginUser(verificationEmail, 'email', permission);
                currentVerificationCode = null;
                verificationEmail = null;
            } else {
                alert('âŒ GeÃ§ersiz doÄŸrulama kodu!');
                document.getElementById('emailCode').focus();
            }
        }

        function startTimer(seconds) {
            clearTimeout(verificationTimer);
            let remaining = seconds;
            const timerElement = document.getElementById('timer');
            function updateTimer() {
                timerElement.textContent = `${Math.floor(remaining/60)}:${(remaining%60).toString().padStart(2,'0')}`;
                if (remaining <= 0) {
                    document.getElementById('codeTimer').innerHTML = '<span style="color:red;">â° SÃ¼re doldu!</span>';
                    document.getElementById('emailBtn').innerHTML = 'ğŸ“§ Yeni Kod GÃ¶nder';
                    document.getElementById('emailBtn').onclick = sendVerificationCode;
                    document.getElementById('emailCode').style.display = 'none';
                    currentVerificationCode = null;
                } else {
                    remaining--;
                    verificationTimer = setTimeout(updateTimer, 1000);
                }
            }
            updateTimer();
        }

        function generateHardwareFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.fillText('fingerprint', 2, 2);
            const fingerprint = [navigator.userAgent, navigator.language, screen.width + 'x' + screen.height, new Date().getTimezoneOffset(), canvas.toDataURL()].join('|');
            let hash = 0;
            for (let i = 0; i < fingerprint.length; i++) {
                hash = ((hash << 5) - hash) + fingerprint.charCodeAt(i);
                hash |= 0;
            }
            return 'HW' + Math.abs(hash).toString(16).toUpperCase();
        }

        function checkHardware() {
            const hwId = generateHardwareFingerprint();
            document.getElementById('hardwareInfo').innerHTML = `Cihaz KimliÄŸi: ${hwId}`;
            if (AUTHORIZED_HARDWARE.has(hwId)) {
                loginUser(`DonanÄ±m-${hwId.slice(-6)}`, 'hardware', 'premium');
            } else {
                alert('âŒ Bu cihaz yetkili deÄŸil!');
            }
        }

        function loginUser(username, method, permission) {
            currentUser = { name: username, method: method, permission: permission };
            sessionExpiry = Date.now() + (2 * 60 * 60 * 1000); // 2 saat
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            let userDisplay = username;
            if (permission === 'premium') userDisplay += '<span class="premium-badge">TAM ERÄ°ÅÄ°M</span>';
            document.getElementById('userInfo').innerHTML = `ğŸ‘¤ ${userDisplay} <button class="logout-btn" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>`;
            updateButtonStates();
            setInterval(checkSession, 60000);
        }

        function updateButtonStates() {
            const fullAccess = hasFullAccess();
            document.querySelectorAll('#dxfBtn, #scriptBtn, #downloadBtn').forEach(btn => {
                if (!fullAccess) {
                    btn.classList.add('btn-locked');
                    btn.innerHTML = `ğŸ”’ ${btn.innerText.split('(')[0]} (Lisans Gerekli)`;
                } else {
                    btn.classList.remove('btn-locked');
                    btn.innerHTML = btn.innerHTML.replace('ğŸ”’ ', '').split('(')[0].trim();
                }
            });
        }

        function checkSession() {
            if (!currentUser || Date.now() > sessionExpiry) {
                alert('â° Oturumunuz sona erdi. Tekrar giriÅŸ yapÄ±n.');
                logout();
            }
        }

        function logout() {
            currentUser = null;
            sessionExpiry = null;
            location.reload();
        }
        
        document.getElementById('inputData').addEventListener('input', function() {
            if (!currentUser) return;
            processedData = parseInput(this.value.trim());
            autoConvertToPoint();
        });

        function parseInput(input) {
            return input.split('\n').filter(l => l.trim() !== '').map(line => {
                const parts = line.trim().split(/\s+/);
                return { id: parts[0], x: parseFloat(parts[1]), y: parseFloat(parts[2]), z: parseFloat(parts[3]) };
            }).filter(p => !isNaN(p.x));
        }

        function autoConvertToPoint() {
            if (!hasFullAccess()) { document.getElementById('outputData').value = ''; return; }
            if (processedData.length === 0) { document.getElementById('outputData').value = ''; return; }
            currentFormat = 'point';
            document.getElementById('outputData').value = processedData.map(p => `_point ${p.x},${p.y},${p.z}`).join('\n');
        }

        function convertToDXF() {
            if (!hasFullAccess()) { requestLicenseForOperation(convertToDXF); return; }
            if (processedData.length === 0) { alert('LÃ¼tfen Ã¶nce koordinat verisi girin!'); return; }
            currentFormat = 'dxf';
            let dxf = `0\nSECTION\n2\nENTITIES\n`;
            processedData.forEach(p => { dxf += `0\nPOINT\n8\n0\n10\n${p.x}\n20\n${p.y}\n30\n${p.z}\n`; });
            dxf += `0\nENDSEC\n0\nEOF`;
            document.getElementById('outputData').value = dxf;
        }

        function convertToScript() {
            if (!hasFullAccess()) { requestLicenseForOperation(convertToScript); return; }
            if (processedData.length === 0) { alert('LÃ¼tfen Ã¶nce koordinat verisi girin!'); return; }
            currentFormat = 'script';
            document.getElementById('outputData').value = processedData.map(p => `point ${p.x},${p.y},${p.z}`).join('\n');
        }

        function downloadFile() {
            if (!hasFullAccess()) { requestLicenseForOperation(downloadFile); return; }
            const output = document.getElementById('outputData').value;
            if (!output.trim()) { alert('Ä°ndirilecek veri yok!'); return; }
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
            let filename, mimeType;
            switch(currentFormat) {
                case 'dxf': filename = `koordinatlar_${timestamp}.dxf`; mimeType = 'application/dxf'; break;
                case 'script': filename = `koordinatlar_${timestamp}.scr`; mimeType = 'text/plain'; break;
                default: filename = `koordinatlar_${timestamp}.txt`; mimeType = 'text/plain';
            }
            const blob = new Blob([output], {type: mimeType});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }

        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
            }
        });

        document.querySelectorAll('input[type="password"]').forEach(el => {
            el.addEventListener('keypress', function(e) { if (e.key === 'Enter') this.nextElementSibling.querySelector('button').click(); });
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() { switchTab(this, this.getAttribute('data-tab')); });
            });
            setTimeout(() => { document.getElementById('hardwareInfo').innerHTML = `Cihaz KimliÄŸi: ${generateHardwareFingerprint()}`; }, 500);
        });
    </script>
</body>
</html>
