# netlify.toml

[functions]
  directory = "netlify/functions"```

### Adım 4: `index.html` Dosyasını Güncelleme

Şimdi `index.html` dosyanızdaki `sendVerificationCode` JavaScript fonksiyonunu, `formspree` veya eski mantık yerine bizim Netlify fonksiyonumuzu çağıracak şekilde değiştirelim.

Aşağıdaki fonksiyonu bulun ve **tamamen değiştirin**:

```javascript
// ESKİ HALİ (SİLİNECEK)
// async function sendVerificationCode() { ... }

// YENİ HALİ (BUNU KULLANIN)
async function sendVerificationCode() {
    const email = document.getElementById('emailInput').value.trim();
    if (!email) {
        alert('E-mail adresinizi girin!');
        document.getElementById('emailInput').focus();
        return;
    }

    const emailBtn = document.getElementById('emailBtn');
    emailBtn.disabled = true;
    emailBtn.innerHTML = '📧 Gönderiliyor...';

    try {
        // Bizim güvenli Netlify fonksiyonumuza istek gönderiyoruz
        const response = await fetch('/.netlify/functions/send-email', {
            method: 'POST',
            body: JSON.stringify({ email: email }),
            headers: { 'Content-Type': 'application/json' }
        });

        const result = await response.json();

        if (!response.ok || !result.success) {
            // Eğer fonksiyon hata döndürürse
            throw new Error(result.message || 'Sunucuda bir hata oluştu.');
        }

        // Fonksiyondan gelen doğrulama kodunu değişkene ata
        currentVerificationCode = result.code;
        verificationEmail = email;

        // Arayüzü güncelle
        document.getElementById('emailCode').style.display = 'block';
        document.getElementById('emailStatus').style.display = 'block';
        document.getElementById('codeTimer').style.display = 'block';
        
        emailBtn.innerHTML = '✓ Kodu Doğrula';
        emailBtn.onclick = verifyEmailCode;
        emailBtn.disabled = false;

        startTimer(300);
        document.getElementById('emailCode').focus();

    } catch (error) {
        console.error('E-mail gönderme hatası:', error);
        alert(`⚠️ E-mail gönderimi başarısız oldu: ${error.message}`);
        emailBtn.innerHTML = '📧 Kod Gönder';
        emailBtn.disabled = false;
    }
}